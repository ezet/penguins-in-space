package no.ntnu.tdt4240.asteroids.game.effect;

import com.badlogic.ashley.core.Entity;
import com.badlogic.ashley.core.PooledEngine;

import org.junit.Before;
import org.junit.Test;

import no.ntnu.tdt4240.asteroids.GameComponent;
import no.ntnu.tdt4240.asteroids.entity.EntityComponent;
import no.ntnu.tdt4240.asteroids.entity.component.DamageComponent;
import no.ntnu.tdt4240.asteroids.entity.component.EffectComponent;
import no.ntnu.tdt4240.asteroids.entity.component.HealthComponent;
import no.ntnu.tdt4240.asteroids.entity.util.EffectTextureFactory;
import no.ntnu.tdt4240.asteroids.service.ServiceLocator;
import no.ntnu.tdt4240.asteroids.service.audio.AudioManager;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

public class InvulnerabilityEffectTest {

    private PooledEngine engine;
    private Entity entity;
    private InvulnerabilityEffect fixture;
    private EffectComponent effectComponent;

    @Before
    public void setup() {
        engine = mock(PooledEngine.class);
        when(engine.createComponent(HealthComponent.class)).thenReturn(new HealthComponent());
        when(engine.createComponent(DamageComponent.class)).thenReturn(new DamageComponent());
        ServiceLocator.gameComponent = mock(GameComponent.class);
        when(ServiceLocator.gameComponent.getAudioManager()).thenReturn(mock(AudioManager.class));
        ServiceLocator.entityComponent = mock(EntityComponent.class);
        when(ServiceLocator.entityComponent.getEffectTextureFactory()).thenReturn(mock(EffectTextureFactory.class));
        entity = mock(Entity.class);
        fixture = new InvulnerabilityEffect();
        effectComponent = mock(EffectComponent.class);
    }

    @Test
    public void applyTest() {
        fixture.tick(engine, entity, effectComponent, 1);
        fixture.tick(engine, entity, effectComponent, 10);
        verify(entity).add(any(DamageComponent.class));
        verify(entity).add(any(HealthComponent.class));
        verify(entity).remove(DamageComponent.class);
    }
}
